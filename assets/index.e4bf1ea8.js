const _=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}};_();class b{constructor(t,e,s){this._quantity=e,this._amount=s,this._date=new Date(t.getTime())}get date(){return new Date(this._date.getTime())}get quantity(){return this._quantity}get amount(){return this._amount}get volume(){return this._amount*this._quantity}isEqual(t){return this.date.getDate()===t.date.getDate()&&this.date.getMonth()===t.date.getMonth()&&this.date.getFullYear()===t.date.getFullYear()&&this.amount===t.amount&&this.quantity===t.quantity}}class L{constructor(){this._negotiations=[],this.observers=new Set}get negotiations(){return this._negotiations}add(t){this.isDuplicate(t)||(this._negotiations.push(t),this.notify("ADD"))}import(t){t.filter(e=>!this.isDuplicate(e)).forEach(e=>this._negotiations.push(e)),this.notify("IMPORT")}clear(){this._negotiations.length!==0&&(this._negotiations.length=0,this.notify("CLEAR"))}subscribe(t){this.observers.add(t)}unsubscribe(t){this.observers.has(t)&&this.observers.delete(t)}delete(t){const e=this._negotiations.findIndex(s=>s.isEqual(t));e<0||(this._negotiations.splice(e,1),this.notify("DELETE"))}notify(t){this.observers.forEach(e=>e.update({action:t,data:this}))}isDuplicate(t){return this.negotiations.some(e=>e.isEqual(t))}}class N{constructor(t){this.connection=t,this.store="negotiation"}async add(t){return new Promise((e,s)=>{const r=this.connection.transaction(this.store,"readwrite").objectStore(this.store).put(t);r.onsuccess=()=>{e()},r.onerror=c=>{const a=c.target;s(a.error)}})}getAll(){return new Promise((t,e)=>{const n=this.connection.transaction(this.store).objectStore(this.store).openCursor(),o=[];n.onsuccess=r=>{const a=r.target.result;if(a){const l=a.value,f=new b(l._date,l._quantity,l._amount);o.push(f),a.continue()}else t(o)},n.onerror=r=>{const c=r.target;e(c.error)}})}delete(t){return new Promise((e,s)=>{const o=this.connection.transaction(this.store,"readwrite").objectStore(this.store).openCursor();o.onsuccess=r=>{const a=r.target.result;if(a){const l=a.value,f=new b(l._date,l._quantity,l._amount);if(t.isEqual(f)){console.log("deletando..."),a.delete(),e();return}a.continue()}},o.onerror=r=>{const c=r.target;s(c.error)}})}clear(){return new Promise((t,e)=>{const o=this.connection.transaction(this.store,"readwrite").objectStore(this.store).clear();o.onsuccess=()=>{t()},o.onerror=r=>{const c=r.target;e(c.error)}})}}class y{constructor(){this.nextHandle=null}setNext(t){return this.nextHandle=t,t}handleNext(t){return this.nextHandle?this.nextHandle.handle(t):!0}}class g extends Error{constructor(t){super(t),this.name=this.constructor.name}}class E extends g{constructor(t){super(`A classe ${t} n\xE3o pode ser instanciada`)}}class q extends g{constructor(){super("A data da negocia\xE7\xE3o est\xE1 inv\xE1lida")}}class T extends g{constructor(){super("A quantidade da negocia\xE7\xE3o est\xE1 inv\xE1lida")}}class R extends g{constructor(){super("O valor da negocia\xE7\xE3o est\xE1 inv\xE1lido")}}class O extends y{handle(t){if(!t.amount)throw new R;return super.handleNext(t)}}class P extends y{handle(t){if(!t.date)throw new q;return super.handleNext(t)}}class A extends y{handle(t){if(t.quantity<=0)throw new T;return super.handleNext(t)}}function u(i){return function(t,e){let s=null;Reflect.defineProperty(t,e,{get(){return s||(s=document.querySelector(i)),s}})}}var M=Object.defineProperty,C=Object.getOwnPropertyDescriptor,S=(i,t,e,s)=>{for(var n=s>1?void 0:s?C(t,e):t,o=i.length-1,r;o>=0;o--)(r=i[o])&&(n=(s?r(t,e,n):r(n))||n);return s&&n&&M(t,e,n),n};class v{constructor(){this.timer=0,this.milliseconds=2e3}update({action:t}){this.print(t),this.setTimer()}print(t){this.element.innerHTML=this.template(t)}setTimer(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.hideMessage(),this.timer=0},this.milliseconds)}hideMessage(){this.element.innerHTML="<p></p>"}template(t){return t?`
    ${V(t)}
    `:`
    <p></p>
    `}}S([u("#mensagemView")],v.prototype,"element",2);function V(i){return{ADD:`
      <p class="alert alert-info">Negocia\xE7\xE3o salva com sucesso</p>
    `,CLEAR:`
      <p class="alert alert-info">Negocia\xE7\xF5es apagadas</p>
    `,IMPORT:`
      <p class="alert alert-info">Negocia\xE7\xF5es Importadas com sucesso</p>
    `,DELETE:`
    <p class="alert alert-info">Negocia\xE7\xE3o deletada com sucesso</p>
  `}[i]}class m{constructor(){throw new E(m.name)}static format(t){return t.toLocaleDateString("pt-BR",{day:"numeric",month:"2-digit",year:"numeric"})}static toDate(t){const e=t.split("-").map(Number);return new Date(e[0],e[1]-1,e[2])}}var j=Object.defineProperty,I=Object.getOwnPropertyDescriptor,$=(i,t,e,s)=>{for(var n=s>1?void 0:s?I(t,e):t,o=i.length-1,r;o>=0;o--)(r=i[o])&&(n=(s?r(t,e,n):r(n))||n);return s&&n&&j(t,e,n),n};class x{constructor(){this.negotiationList=null,this.init()}update({data:t}){this.negotiationList=t;const e=this.createTableRows(t.negotiations);e.push(this.createVolumeTotalTableRow()),this.print(e)}createVolumeTotalTableRow(){const t=document.createElement("tr");return t.innerHTML=`
      <td colspan="3"></td>
      <td colspan="2" align="right">Total: ${this.getVolumeTotal()}</td>
    `,t}getVolumeTotal(){return this.negotiationList.negotiations.reduce((t,e)=>t+e.volume,0)}print(t){const e=this.element.querySelector("tbody"),s=document.createElement("tbody");s.append(...t),e==null||e.replaceWith(s)}createTable(){this.element.innerHTML=`
      <table class="table table-hover table-bordered">
        <thead>
          <tr>
            <th>DATA</th>
            <th>QUANTIDADE</th>
            <th>VALOR</th>
            <th>VOLUME</th>
            <th>A\xC7\xC3O</th>
          </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
        </tfoot>
      </table>
    `}createTableRows(t){return t.map(e=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${m.format(e.date)}</td>
        <td>${e.quantity}</td>
        <td>${e.amount}</td>
        <td>${e.volume}</td>
      `;const n=document.createElement("td"),o=this.createDeleteButton(e);return n.appendChild(o),s.appendChild(n),s})}createDeleteButton(t){const e=document.createElement("button");return e.classList.add("btn","btn-primary"),e.textContent="Excluir",e.onclick=()=>this.handleDeleteNegotiation(t),e}handleDeleteNegotiation(t){var e;return(e=this.negotiationList)==null||e.delete(t),t}init(){this.createTable()}}$([u("#negociacoes")],x.prototype,"element",2);const D=class{constructor(){throw new E(D.constructor.name)}static getConnection(){return new Promise((i,t)=>{this.connection&&i(this.connection);const e=indexedDB.open(this.dbName,this.version);e.onupgradeneeded=s=>{const n=s.target;this.createStores(n.result)},e.onsuccess=s=>{const n=s.target;this.connection=n.result,i(this.connection)},e.onerror=s=>{var o;const n=s.target;t((o=n.error)==null?void 0:o.message)}})}static createStores(i){this.stores.forEach(t=>{i!=null&&i.objectStoreNames.contains(t)&&i.deleteObjectStore(t),i==null||i.createObjectStore(t,{autoIncrement:!0})})}};let h=D;h.connection=null;h.dbName="cahmoaes@negotiations";h.stores=["negotiation"];h.version=1;class F{static async getNegotiationDao(){try{const t=await h.getConnection();return new N(t)}catch(t){throw console.log(t),new Error("N\xE3o foi poss\xEDvel obter a conex\xE3o")}}}class w{static create(t,e,...s){return new Proxy(t,{get(n,o,r){return w.isFunction(n,o)&&s.includes(String(o))?function(...c){const a=Reflect.apply(n[o],n,c);return e(a),a}:Reflect.get(n,o,r)}})}static isFunction(t,e){return typeof t[String(e)]=="function"}}var B=Object.defineProperty,H=Object.getOwnPropertyDescriptor,p=(i,t,e,s)=>{for(var n=s>1?void 0:s?H(t,e):t,o=i.length-1,r;o>=0;o--)(r=i[o])&&(n=(s?r(t,e,n):r(n))||n);return s&&n&&B(t,e,n),n};class d{constructor(){this.negotiationsList=new L,this.messageView=new v,this.negotiationView=w.create(new x,t=>this.delete(t),"handleDeleteNegotiation"),this.init()}async add(t){var e;t.preventDefault();try{const s=this.create(this.inputDate.value,this.inputQuantity.value,this.inputAmount.value);this.validate(s)&&(await((e=this.negotiationDao)==null?void 0:e.add(s)),this.negotiationsList.add(s))}catch(s){console.log(s)}finally{this.reset()}}create(t,e,s){return new b(m.toDate(t),parseInt(e),parseFloat(s))}validate(t){const e=new P;return e.setNext(new A).setNext(new O),e.handle(t)}addEvents(){var t,e;(t=this.form)==null||t.addEventListener("submit",this.add),(e=this.clearButton)==null||e.addEventListener("click",this.clearNegotiationList)}bindEvent(){this.add=this.add.bind(this),this.clearNegotiationList=this.clearNegotiationList.bind(this)}async clearNegotiationList(){try{this.negotiationsList.clear(),await this.negotiationDao.clear()}catch(t){console.log(t)}}reset(){this.inputAmount.value="0",this.inputQuantity.value="0.0",this.inputDate.value=""}async init(){this.bindEvent(),this.addEvents(),this.negotiationsList.subscribe(this.negotiationView),this.negotiationsList.subscribe(this.messageView);try{this.negotiationDao=await F.getNegotiationDao();const t=await this.negotiationDao.getAll();this.negotiationsList.import(t)}catch(t){console.log(t)}}async delete(t){console.log("Deleting negotiation"),console.log({negotiation:t});try{this.negotiationDao.delete(t)}catch(e){console.log(e)}}}p([u("form")],d.prototype,"form",2);p([u("#data")],d.prototype,"inputDate",2);p([u("#quantidade")],d.prototype,"inputQuantity",2);p([u("#valor")],d.prototype,"inputAmount",2);p([u("#botao-apaga")],d.prototype,"clearButton",2);new d;
